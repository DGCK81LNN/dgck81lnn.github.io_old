<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css3/basic.css">
<link rel="stylesheet" type="text/css" href="/css3/night.css">
<title>灵魂小站临时测试站点</title>
</head>
<body>
<div class="soultpl-heading-placeholder"> </div>
<div class="soultpl-heading-box">灵魂小站临时测试站点</div>
<p>本测试站点使用GitHub Pages搭建，不能运行PHP。因此一些功能用Javascript（特别是Ajax）代替。</p>
<div class="soulbox">
<ul id="list">
Ajax加载内容……
</ol>
</div>
<script>
let xhr=new XMLHttpRequest();
xhr.open("get", "/plans.json");
xhr.addEventListener("load", () => {
  let result = xhr.responseText;
  let list = document.getElementById("list");
  let arr;
  try {
    arr = JSON.parse(result);
  }
  catch(err) {
    list.innerText = "解析JSON失败：" + err.message;
    return;
  }
  if(!(arr instanceof Array && arr.length)){
    list.innerText = "测试站点没有内容……";
    return;
  }
  list.innerHTML = "";
  arr.forEach(obj => {
    let item = document.createElement("li");
    let anchor = document.createElement("a");
    if(obj.href) anchor.href = obj.href;
    anchor.innerHTML = obj.title;
    item.appendChild(anchor);
    if("value" in obj || "max" in obj){
      let progress = document.createElement("progress");
      if("value" in obj)
        progress.value = obj.value;
      if("max" in obj)
        progress.max = obj.max;
      progress.style.width = `${"max" in obj ? obj.max : 1}rem`;
      progress.title = `${obj.value || 0} / ${obj.max || 1}`;
      item.appendChild(document.createElement("br"));
      item.appendChild(progress);
    }
    if(obj.info instanceof Array){
      let info = document.createElement("ul");
      let latest = document.createElement("li");
      latest.innerHTML = obj.info[0];
      info.appendChild(latest);
      if(obj.info.length > 1){
        let more = document.createElement("details");
        for(let i = 1; i < obj.info.length; i++){
          let hist = document.createElement("li");
          hist.innerHTML = obj.info[i];
          more.appendChild(hist);
        }
        info.appendChild(more);
      }
      item.appendChild(info);
    }
    list.appendChild(item);
  });
});
xhr.send();
</script>
</body>
</html>
