<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css3/basic.css">
<link rel="stylesheet" type="text/css" href="/css3/night.css">
<title>灵魂小站临时测试站点</title>
</head>
<body>
<div class="soultpl-heading-placeholder"> </div>
<div class="soultpl-heading-box">灵魂小站临时测试站点</div>
<p>本测试站点使用GitHub Pages搭建，不能运行PHP。因此一些功能用Javascript（特别是Ajax）代替。</p>
<h2>测试项目</h2>
<div class="soulbox">
<ol id="testList">
Ajax加载内容……
</ol>
</div>
<h2>计划项目</h2>
<div class="soulbox">
<ol id="planList">
Ajax加载内容……
</ol>
</div>
<script>
let handler = (xhr, id) => {
  let result = xhr.responseText;
  let list = document.getElementById(id);
  let arr;
  try {
    arr = JSON.parse(result);
  }
  catch(err) {
    list.innerText = "解析JSON失败：" + err.message;
    return;
  }
  if(!(arr instanceof Array && arr.length)){
    list.innerText = "没有内容……";
    return;
  }
  list.innerHTML = "";
  arr.forEach(obj => {
    let item = document.createElement("li");
    let anchor = document.createElement("a");
    if(obj.href) anchor.href = obj.href;
    anchor.innerHTML = obj.title;
    item.appendChild(anchor);
    if("value" in obj || "max" in obj){
      let progress = document.createElement("progress");
      if("value" in obj)
        progress.value = obj.value;
      if("max" in obj)
        progress.max = obj.max;
      if("barWidth" in obj)
        progress.style.width = obj.barWidth;
      progress.title = `${obj.value || 0} / ${obj.max || 1}`;
      item.appendChild(document.createElement("br"));
      item.appendChild(progress);
    }
    list.appendChild(item);
  });
}
let xhr1 = new XMLHttpRequest();
xhr1.open("get", "/tests.json");
xhr1.addEventListener("load", () => void handler(xhr1, "testList"));
xhr1.send();
let xhr2=new XMLHttpRequest();
xhr2.open("get", "/plans.json");
xhr2.addEventListener("load", () => void handler(xhr2, "planList"));
xhr2.send();
</script>
</body>
</html>

